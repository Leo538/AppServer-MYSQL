<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Test API</title>
  <link rel="stylesheet" href="./styless.css" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
  <header>
    <h1>üé¨ Gesti√≥n de Pel√≠culas</h1>
    <button id="btn-agregar" class="btn-agregar">‚ûï Agregar Pel√≠cula</button>
  </header>
  <main></main>

  <script type="module">
    const genres = ['Action', 'Adventure', 'Comedy', 'Drama', 'Crime', 'Fantasy', 'Horror', 'Thriller', 'Sci-Fi'];

    // üé¨ ARRAY DE PEL√çCULAS EN MEMORIA
    let movies = [
      {
        "id": "dcdd0fad-a94c-4810-8acc-5f108d3b18c3",
        "title": "The Shawshank Redemption",
        "year": 1994,
        "director": "Frank Darabont",
        "duration": 142,
        "poster": "https://i.ebayimg.com/images/g/4goAAOSwMyBe7hnQ/s-l1200.webp",
        "genre": ["Drama"],
        "rate": 9.3
      },
      {
        "id": "c8a7d63f-3b04-44d3-9d95-8782fd7dcfaf",
        "title": "The Dark Knight",
        "year": 2008,
        "director": "Christopher Nolan",
        "duration": 152,
        "poster": "https://i.ebayimg.com/images/g/yokAAOSw8w1YARbm/s-l1200.jpg",
        "genre": ["Action", "Crime", "Drama"],
        "rate": 9.0
      },
      {
        "id": "5ad1a235-0d9c-410a-b32b-220d91689a08",
        "title": "Inception",
        "year": 2010,
        "director": "Christopher Nolan",
        "duration": 148,
        "poster": "https://m.media-amazon.com/images/I/91Rc8cAmnAL._AC_UF1000,1000_QL80_.jpg",
        "genre": ["Action", "Adventure", "Sci-Fi"],
        "rate": 8.8
      },
      {
        "id": "241bf55d-b649-4109-af7c-0e6890ded3fc",
        "title": "Pulp Fiction",
        "year": 1994,
        "director": "Quentin Tarantino",
        "duration": 154,
        "poster": "https://www.themoviedb.org/t/p/original/vQWk5YBFWF4bZaofAbv0tShwBvQ.jpg",
        "genre": ["Crime", "Drama"],
        "rate": 8.9
      },
      {
        "id": "9e6106f0-848b-4810-a11a-3d832a5610f9",
        "title": "Forrest Gump",
        "year": 1994,
        "director": "Robert Zemeckis",
        "duration": 142,
        "poster": "https://i.ebayimg.com/images/g/qR8AAOSwkvRZzuMD/s-l1600.jpg",
        "genre": ["Drama", "Romance"],
        "rate": 8.8
      },
      {
        "id": "7e3fd5ab-60ff-4ae2-92b6-9597f0308d1",
        "title": "Gladiator",
        "year": 2000,
        "director": "Ridley Scott",
        "duration": 155,
        "poster": "https://img.fruugo.com/product/0/60/14417600_max.jpg",
        "genre": ["Action", "Adventure", "Drama"],
        "rate": 8.5
      },
      {
        "id": "c906673b-3948-4402-ac7f-73ac3a9e3105",
        "title": "The Matrix",
        "year": 1999,
        "director": "Lana Wachowski",
        "duration": 136,
        "poster": "https://i.ebayimg.com/images/g/QFQAAOSwAQpfjaA6/s-l1200.jpg",
        "genre": ["Action", "Sci-Fi"],
        "rate": 8.7
      },
      {
        "id": "b6e03689-cccd-478e-8565-d92f40813b13",
        "title": "Interstellar",
        "year": 2014,
        "director": "Christopher Nolan",
        "duration": 169,
        "poster": "https://m.media-amazon.com/images/I/91obuWzA3XL._AC_UF1000,1000_QL80_.jpg",
        "genre": ["Adventure", "Drama", "Sci-Fi"],
        "rate": 8.6
      },
      {
        "id": "aa391090-b938-42eb-b520-86ea0aa3917b",
        "title": "The Lord of the Rings: The Return of the King",
        "year": 2003,
        "director": "Peter Jackson",
        "duration": 201,
        "poster": "https://i.ebayimg.com/images/g/0hoAAOSwe7peaMLW/s-l1600.jpg",
        "genre": ["Action", "Adventure", "Drama"],
        "rate": 8.9
      },
      {
        "id": "2e6900e2-0b48-4fb6-ad48-09c7086e54fe",
        "title": "The Lion King",
        "year": 1994,
        "director": "Roger Allers, Rob Minkoff",
        "duration": 88,
        "poster": "https://m.media-amazon.com/images/I/81BMmrwSFOL._AC_UF1000,1000_QL80_.jpg",
        "genre": ["Animation", "Adventure", "Drama"],
        "rate": 8.5
      },
      {
        "id": "04986507-b3ed-442c-8ae7-4c5df804f896",
        "title": "The Avengers",
        "year": 2012,
        "director": "Joss Whedon",
        "duration": 143,
        "poster": "https://img.fruugo.com/product/7/41/14532417_max.jpg",
        "genre": ["Action", "Adventure", "Sci-Fi"],
        "rate": 8.0
      },
      {
        "id": "7d2832f8-c70a-410e-8963-4c93bf36cc9c",
        "title": "Jurassic Park",
        "year": 1993,
        "director": "Steven Spielberg",
        "duration": 127,
        "poster": "https://vice-press.com/cdn/shop/products/Jurassic-Park-Editions-poster-florey.jpg?v=1654518755&width=1024",
        "genre": ["Adventure", "Sci-Fi"],
        "rate": 8.1
      },
      {
        "id": "ccf36f2e-8566-47f7-912d-9f4647250bc7",
        "title": "Titanic",
        "year": 1997,
        "director": "James Cameron",
        "duration": 195,
        "poster": "https://i.pinimg.com/originals/42/42/65/4242658e6f1b0d6322a4a93e0383108b.png",
        "genre": ["Drama", "Romance"],
        "rate": 7.8
      },
      {
        "id": "8fb17ae1-bdfe-45e5-a871-4772d7e526b8",
        "title": "The Social Network",
        "year": 2010,
        "director": "David Fincher",
        "duration": 120,
        "poster": "https://i.pinimg.com/originals/7e/37/b9/7e37b994b613e94cba64f307b1983e39.jpg",
        "genre": ["Biography", "Drama"],
        "rate": 7.7
      },
      {
        "id": "6a360a18-c645-4b47-9a7b-2a71babbf3e0",
        "title": "Avatar",
        "year": 2009,
        "director": "James Cameron",
        "duration": 162,
        "poster": "https://i.etsystatic.com/35681979/r/il/dfe3ba/3957859451/il_fullxfull.3957859451_h27r.jpg",
        "genre": ["Action", "Adventure", "Fantasy"],
        "rate": 7.8
      }
    ];

    // Funci√≥n para generar ID √∫nico
    function generateId() {
      return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
    }

    // Funci√≥n para cargar y mostrar pel√≠culas
    function loadMovies() {
      renderMovies(movies);
    }

    // Funci√≥n para renderizar las pel√≠culas
    function renderMovies(moviesArray) {
      const html = moviesArray.map(movie => `
        <article data-id="${movie.id}">
          <h2>${movie.title}</h2>
          <img src="${movie.poster}" alt="${movie.title}">
          <p><strong>A√±o:</strong> ${movie.year}</p>
          <p><strong>Director:</strong> ${movie.director || 'N/A'}</p>
          <p><strong>Duraci√≥n:</strong> ${movie.duration} min</p>
          <p><strong>G√©nero:</strong> ${Array.isArray(movie.genre) ? movie.genre.join(', ') : movie.genre}</p>
          <p><strong>Calificaci√≥n:</strong> ${movie.rate}/10</p>
          <div class="button-group">
            <button class="btn-editar" data-id="${movie.id}">‚úèÔ∏è Editar</button>
            <button class="btn-eliminar" data-id="${movie.id}">üóëÔ∏è Eliminar</button>
          </div>
        </article>
      `).join('');

      document.querySelector('main').innerHTML = html;
    }

    // Funci√≥n para mostrar formulario de crear/editar
    async function showMovieForm(movie = null) {
      const isEdit = movie !== null;
      const selectedGenres = movie && movie.genre ? movie.genre : [];
      
      // Crear checkboxes para g√©neros
      const genreCheckboxes = genres.map(g => {
        const isChecked = selectedGenres.includes(g);
        return `
          <label class="genre-checkbox-label">
            <input type="checkbox" class="genre-checkbox" value="${g}" ${isChecked ? 'checked' : ''}>
            <span>${g}</span>
          </label>
        `;
      }).join('');

      const { value: formValues } = await Swal.fire({
        title: isEdit ? '<span style="font-size: 24px; color: #333;">‚úèÔ∏è Editar Pel√≠cula</span>' : '<span style="font-size: 24px; color: #333;">‚ûï Agregar Nueva Pel√≠cula</span>',
        html: `
          <div style="text-align: left; max-width: 100%;">
            <div style="margin-bottom: 18px;">
              <label style="display: block; font-weight: 600; color: #2c3e50; margin-bottom: 6px; font-size: 14px;">T√≠tulo <span style="color: #e74c3c;">*</span></label>
              <input id="swal-title" style="width: 100%; padding: 10px 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box; transition: border-color 0.3s;" placeholder="Ej: The Matrix" value="${movie?.title || ''}" required>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 18px;">
              <div>
                <label style="display: block; font-weight: 600; color: #2c3e50; margin-bottom: 6px; font-size: 14px;">A√±o <span style="color: #e74c3c;">*</span></label>
                <input id="swal-year" style="width: 100%; padding: 10px 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box; transition: border-color 0.3s;" type="number" placeholder="2024" min="1900" max="2025" value="${movie?.year || ''}" required>
              </div>
              <div>
                <label style="display: block; font-weight: 600; color: #2c3e50; margin-bottom: 6px; font-size: 14px;">Duraci√≥n (min) <span style="color: #e74c3c;">*</span></label>
                <input id="swal-duration" style="width: 100%; padding: 10px 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box; transition: border-color 0.3s;" type="number" placeholder="120" min="1" value="${movie?.duration || ''}" required>
              </div>
            </div>
            
            <div style="margin-bottom: 18px;">
              <label style="display: block; font-weight: 600; color: #2c3e50; margin-bottom: 6px; font-size: 14px;">Director <span style="color: #e74c3c;">*</span></label>
              <input id="swal-director" style="width: 100%; padding: 10px 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box; transition: border-color 0.3s;" placeholder="Ej: Christopher Nolan" value="${movie?.director || ''}" required>
            </div>
            
            <div style="margin-bottom: 18px;">
              <label style="display: block; font-weight: 600; color: #2c3e50; margin-bottom: 6px; font-size: 14px;">URL del Poster <span style="color: #e74c3c;">*</span></label>
              <input id="swal-poster" style="width: 100%; padding: 10px 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box; transition: border-color 0.3s;" type="url" placeholder="https://ejemplo.com/poster.jpg" value="${movie?.poster || ''}" required>
            </div>
            
            <div style="margin-bottom: 18px;">
              <label style="display: block; font-weight: 600; color: #2c3e50; margin-bottom: 6px; font-size: 14px;">Calificaci√≥n (0-10) <span style="color: #e74c3c;">*</span></label>
              <input id="swal-rate" style="width: 100%; padding: 10px 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box; transition: border-color 0.3s;" type="number" step="0.1" placeholder="5.0" min="0" max="10" value="${movie?.rate || 5}" required>
            </div>
            
            <div style="margin-bottom: 18px;">
              <label style="display: block; font-weight: 600; color: #2c3e50; margin-bottom: 8px; font-size: 14px;">G√©neros <span style="color: #e74c3c;">*</span></label>
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 12px; background: #f8f9fa; border: 2px solid #ddd; border-radius: 6px; max-height: 160px; overflow-y: auto;">
                ${genreCheckboxes}
              </div>
              <small style="display: block; color: #7f8c8d; font-size: 11px; margin-top: 5px;">Selecciona uno o m√°s g√©neros</small>
            </div>
          </div>
        `,
        width: '650px',
        padding: '2rem',
        focusConfirm: false,
        showCancelButton: true,
        confirmButtonText: isEdit ? 'üíæ Guardar Cambios' : '‚ú® Crear Pel√≠cula',
        cancelButtonText: '‚ùå Cancelar',
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#6c757d',
        background: '#fff',
        color: '#333',
        customClass: {
          popup: 'custom-swal-popup',
          htmlContainer: 'custom-swal-html'
        },
        didOpen: () => {
          // Agregar estilos din√°micos mejorados
          const style = document.createElement('style');
          style.id = 'swal-custom-styles';
          style.textContent = `
            .custom-swal-popup {
              border-radius: 16px !important;
              box-shadow: 0 20px 60px rgba(0,0,0,0.3) !important;
              padding: 0 !important;
            }
            .custom-swal-html {
              padding: 0 !important;
              margin: 0 !important;
            }
            .swal2-title {
              padding: 20px 20px 10px 20px !important;
              margin-bottom: 10px !important;
            }
            .swal2-html-container {
              padding: 0 20px 10px 20px !important;
            }
            .swal2-actions {
              padding: 15px 20px 20px 20px !important;
              margin-top: 10px !important;
            }
            input[type="text"],
            input[type="number"],
            input[type="url"] {
              width: 100% !important;
              padding: 10px 12px !important;
              border: 2px solid #ddd !important;
              border-radius: 6px !important;
              font-size: 14px !important;
              box-sizing: border-box !important;
              transition: all 0.3s ease !important;
              font-family: Arial, sans-serif !important;
            }
            input[type="text"]:focus,
            input[type="number"]:focus,
            input[type="url"]:focus {
              outline: none !important;
              border-color: #3085d6 !important;
              box-shadow: 0 0 0 3px rgba(48, 133, 214, 0.1) !important;
            }
            .genre-checkbox-label {
              display: flex !important;
              align-items: center !important;
              cursor: pointer !important;
              padding: 8px 10px !important;
              border-radius: 5px !important;
              transition: all 0.2s ease !important;
              background: #fff !important;
              border: 1px solid #e0e0e0 !important;
            }
            .genre-checkbox-label:hover {
              background-color: #e8f4f8 !important;
              border-color: #3085d6 !important;
              transform: translateY(-1px) !important;
            }
            .genre-checkbox {
              margin-right: 8px !important;
              width: 18px !important;
              height: 18px !important;
              cursor: pointer !important;
              accent-color: #3085d6 !important;
            }
            .genre-checkbox:checked + span {
              font-weight: 600 !important;
              color: #3085d6 !important;
            }
            .swal2-confirm {
              font-weight: 600 !important;
              padding: 12px 30px !important;
              border-radius: 8px !important;
              transition: all 0.3s ease !important;
            }
            .swal2-confirm:hover {
              transform: translateY(-2px) !important;
              box-shadow: 0 4px 12px rgba(48, 133, 214, 0.4) !important;
            }
            .swal2-cancel {
              font-weight: 600 !important;
              padding: 12px 30px !important;
              border-radius: 8px !important;
              transition: all 0.3s ease !important;
            }
            .swal2-cancel:hover {
              transform: translateY(-2px) !important;
              box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3) !important;
            }
          `;
          // Remover estilos anteriores si existen
          const existingStyle = document.getElementById('swal-custom-styles');
          if (existingStyle) existingStyle.remove();
          document.head.appendChild(style);
          
          // Agregar eventos de focus a los inputs
          const inputs = document.querySelectorAll('input[type="text"], input[type="number"], input[type="url"]');
          inputs.forEach(input => {
            input.addEventListener('focus', function() {
              this.style.borderColor = '#3085d6';
              this.style.boxShadow = '0 0 0 3px rgba(48, 133, 214, 0.1)';
            });
            input.addEventListener('blur', function() {
              this.style.borderColor = '#ddd';
              this.style.boxShadow = 'none';
            });
          });
        },
        preConfirm: () => {
          const title = document.getElementById('swal-title').value.trim();
          const year = parseInt(document.getElementById('swal-year').value);
          const director = document.getElementById('swal-director').value.trim();
          const duration = parseInt(document.getElementById('swal-duration').value);
          const poster = document.getElementById('swal-poster').value.trim();
          const rate = parseFloat(document.getElementById('swal-rate').value);
          const genreCheckboxes = document.querySelectorAll('.genre-checkbox:checked');
          const genre = Array.from(genreCheckboxes).map(cb => cb.value);

          if (!title) {
            Swal.showValidationMessage('El t√≠tulo es requerido');
            return false;
          }
          if (!year || year < 1900 || year > 2025) {
            Swal.showValidationMessage('El a√±o debe estar entre 1900 y 2025');
            return false;
          }
          if (!director) {
            Swal.showValidationMessage('El director es requerido');
            return false;
          }
          if (!duration || duration < 1) {
            Swal.showValidationMessage('La duraci√≥n debe ser mayor a 0');
            return false;
          }
          if (!poster) {
            Swal.showValidationMessage('La URL del poster es requerida');
            return false;
          }
          if (genre.length === 0) {
            Swal.showValidationMessage('Debes seleccionar al menos un g√©nero');
            return false;
          }
          if (!rate || rate < 0 || rate > 10) {
            Swal.showValidationMessage('La calificaci√≥n debe estar entre 0 y 10');
            return false;
          }

          return {
            title,
            year,
            director,
            duration,
            poster,
            rate: rate || 5,
            genre
          };
        }
      });

      if (formValues) {
        if (isEdit) {
          updateMovie(movie.id, formValues);
        } else {
          createMovie(formValues);
        }
      }
    }

    // Funci√≥n para crear pel√≠cula (en memoria)
    function createMovie(movieData) {
      const newMovie = {
        id: generateId(),
        ...movieData
      };
      movies.push(newMovie);
      
      Swal.fire({
        title: '¬°√âxito!',
        text: 'Pel√≠cula creada correctamente.',
        icon: 'success',
        confirmButtonColor: '#3085d6',
        background: '#fff',
        color: '#333'
      });
      loadMovies();
    }

    // Funci√≥n para actualizar pel√≠cula (en memoria)
    function updateMovie(id, movieData) {
      const movieIndex = movies.findIndex(m => m.id === id);
      if (movieIndex === -1) {
        Swal.fire('Error', 'Pel√≠cula no encontrada.', 'error');
        return;
      }
      
      movies[movieIndex] = {
        ...movies[movieIndex],
        ...movieData
      };
      
      Swal.fire({
        title: '¬°√âxito!',
        text: 'Pel√≠cula actualizada correctamente.',
        icon: 'success',
        confirmButtonColor: '#3085d6',
        background: '#fff',
        color: '#333'
      });
      loadMovies();
    }

    // Funci√≥n para eliminar pel√≠cula (en memoria)
    function deleteMovie(id, title) {
      Swal.fire({
        title: '<span style="font-size: 24px; color: #333;">‚ö†Ô∏è Confirmar Eliminaci√≥n</span>',
        html: `
          <div style="text-align: center; padding: 10px 0;">
            <p style="font-size: 16px; color: #2c3e50; margin-bottom: 15px; line-height: 1.5;">
              ¬øEst√°s seguro de que deseas eliminar esta pel√≠cula?
            </p>
            <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 15px; margin: 15px 0;">
              <p style="font-size: 20px; font-weight: bold; color: #e74c3c; margin: 0;">
                "${title}"
              </p>
            </div>
            <p style="font-size: 13px; color: #7f8c8d; font-style: italic; margin-top: 10px;">
              ‚ö†Ô∏è Esta acci√≥n no se puede deshacer
            </p>
          </div>
        `,
        icon: 'warning',
        iconColor: '#e74c3c',
        showCancelButton: true,
        confirmButtonColor: '#e74c3c',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'üóëÔ∏è S√≠, eliminar',
        cancelButtonText: '‚ùå Cancelar',
        background: '#fff',
        color: '#333',
        reverseButtons: true,
        focusCancel: true,
        customClass: {
          popup: 'custom-swal-popup',
          title: 'custom-swal-title',
          confirmButton: 'custom-swal-confirm'
        },
        width: '500px',
        padding: '2rem'
      }).then((result) => {
        if (result.isConfirmed) {
          const movieIndex = movies.findIndex(m => m.id === id);
          if (movieIndex !== -1) {
            movies.splice(movieIndex, 1);
            Swal.fire({
              title: 'Eliminado',
              text: `"${title}" se elimin√≥ correctamente.`,
              icon: 'success',
              confirmButtonColor: '#3085d6',
              background: '#fff',
              color: '#333'
            });
            loadMovies();
          } else {
            Swal.fire('Error', 'Pel√≠cula no encontrada.', 'error');
          }
        }
      });
    }

    // Event listeners
    document.getElementById('btn-agregar').addEventListener('click', () => showMovieForm());

    document.addEventListener('click', e => {
      if (e.target.matches('.btn-eliminar')) {
        const id = e.target.dataset.id;
        const article = e.target.closest('article');
        const title = article.querySelector('h2').textContent;
        deleteMovie(id, title);
      } else if (e.target.matches('.btn-editar')) {
        const id = e.target.dataset.id;
        const movie = movies.find(m => m.id === id);
        if (movie) {
          showMovieForm(movie);
        } else {
          Swal.fire('Error', 'Pel√≠cula no encontrada.', 'error');
        }
      }
    });

    // Cargar pel√≠culas al iniciar
    loadMovies();
  </script>
</body>
</html>
